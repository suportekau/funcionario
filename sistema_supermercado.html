<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Sistema Simples - Funcion√°rios (Firebase)</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #f4f4f4;
    margin: 0;
    padding: 10px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  h1 {
    color: #333;
  }
  form {
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
    width: 100%;
    max-width: 400px;
    margin-bottom: 10px;
  }
  input, select, button {
    width: 100%;
    padding: 10px;
    margin: 6px 0;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-size: 14px;
  }
  button {
    background-color: #007bff;
    color: white;
    border: none;
    cursor: pointer;
  }
  button:hover {
    background-color: #0056b3;
  }
  #menu, #cadastro, #lancamentos {
    display: none;
    width: 100%;
    max-width: 500px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
  }
  table, th, td {
    border: 1px solid #ccc;
  }
  th, td {
    padding: 8px;
    text-align: left;
  }
</style>
</head>
<body>
<h1>Sistema de Funcion√°rios</h1>

<!-- LOGIN -->
<div id="login">
  <form onsubmit="entrar(event)">
    <input type="text" id="usuario" placeholder="Usu√°rio" required>
    <input type="password" id="senha" placeholder="Senha" required>
    <button type="submit">Entrar</button>
  </form>
</div>

<!-- MENU -->
<div id="menu">
  <button onclick="mostrarCadastro()">Cadastro de Funcion√°rios</button>
  <button onclick="mostrarLancamentos()">Lan√ßamentos</button>
  <button onclick="gerarPDF()">Gerar PDF</button>
  <button onclick="sair()">Sair</button>
</div>

<!-- CADASTRO -->
<div id="cadastro">
  <form onsubmit="salvarFuncionario(event)">
    <input type="hidden" id="idFunc">
    <input type="text" id="nomeFunc" placeholder="Nome do Funcion√°rio" required>
    <input type="text" id="cargoFunc" placeholder="Cargo" required>
    <button type="submit">Salvar</button>
  </form>
  <div id="listaFunc"></div>
</div>

<!-- LAN√áAMENTOS -->
<div id="lancamentos">
  <form onsubmit="salvarLancamento(event)">
    <input type="hidden" id="idLanc">
    <select id="funcLanc" required></select>
    <input type="date" id="dataLanc" required>
    <input type="number" id="valorLanc" step="0.01" placeholder="Valor" required>
    <button type="submit">Salvar</button>
  </form>
  <div id="listaLanc"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
const urlBase = "https://funcionarios-7c778-default-rtdb.firebaseio.com/";

/* === LOGIN === */
function entrar(e) {
  e.preventDefault();
  const u = usuario.value.trim();
  const s = senha.value.trim();
  if (u === "ADMIN" && s === "1234") {
    login.style.display = "none";
    menu.style.display = "block";
    focoPrimeiro(menu);
  } else alert("Usu√°rio ou senha incorretos!");
}

function sair() {
  menu.style.display = "none";
  cadastro.style.display = "none";
  lancamentos.style.display = "none";
  login.style.display = "block";
  focoPrimeiro(login);
}

/* === TELA CADASTRO === */
function mostrarCadastro() {
  menu.style.display = "none";
  lancamentos.style.display = "none";
  cadastro.style.display = "block";
  listarFuncionarios();
  focoPrimeiro(cadastro);
}

/* === TELA LAN√áAMENTOS === */
function mostrarLancamentos() {
  menu.style.display = "none";
  cadastro.style.display = "none";
  lancamentos.style.display = "block";
  carregarFuncionariosSelect();
  listarLancamentos();
  focoPrimeiro(lancamentos);
}

/* === FOCO NO PRIMEIRO CAMPO === */
function focoPrimeiro(container) {
  const campo = container.querySelector("input:not([type=hidden]), select, textarea, button");
  if (campo) campo.focus();
}

/* === CADASTRO FUNCION√ÅRIOS === */
async function salvarFuncionario(e) {
  e.preventDefault();
  const id = idFunc.value || Date.now();
  const dados = {
    nome: nomeFunc.value,
    cargo: cargoFunc.value
  };
  await fetch(`${urlBase}/funcionarios/${id}.json`, {
    method: "PUT",
    body: JSON.stringify(dados)
  });
  idFunc.value = "";
  e.target.reset();
  listarFuncionarios();
  focoPrimeiro(cadastro);
}

async function listarFuncionarios() {
  const resp = await fetch(`${urlBase}/funcionarios.json`);
  const dados = await resp.json() || {};
  let html = "<table><tr><th>Nome</th><th>Cargo</th><th>A√ß√µes</th></tr>";
  for (const [id, f] of Object.entries(dados)) {
    html += `<tr>
      <td>${f.nome}</td>
      <td>${f.cargo}</td>
      <td>
        <button onclick="editarFuncionario('${id}')">‚úèÔ∏è</button>
        <button onclick="excluirFuncionario('${id}')">üóëÔ∏è</button>
      </td>
    </tr>`;
  }
  html += "</table>";
  listaFunc.innerHTML = html;
}

async function editarFuncionario(id) {
  const resp = await fetch(`${urlBase}/funcionarios/${id}.json`);
  const f = await resp.json();
  idFunc.value = id;
  nomeFunc.value = f.nome;
  cargoFunc.value = f.cargo;
  focoPrimeiro(cadastro);
}

async function excluirFuncionario(id) {
  if (!confirm("Excluir funcion√°rio?")) return;
  await fetch(`${urlBase}/funcionarios/${id}.json`, { method: "DELETE" });
  listarFuncionarios();
}

/* === LAN√áAMENTOS === */
async function carregarFuncionariosSelect() {
  const resp = await fetch(`${urlBase}/funcionarios.json`);
  const dados = await resp.json() || {};
  funcLanc.innerHTML = "<option value=''>Selecione</option>";
  for (const [id, f] of Object.entries(dados)) {
    funcLanc.innerHTML += `<option value="${id}">${f.nome}</option>`;
  }
}

async function salvarLancamento(e) {
  e.preventDefault();
  const id = idLanc.value || Date.now();
  const dados = {
    func: funcLanc.value,
    data: dataLanc.value,
    valor: parseFloat(valorLanc.value)
  };
  await fetch(`${urlBase}/lancamentos/${id}.json`, {
    method: "PUT",
    body: JSON.stringify(dados)
  });
  idLanc.value = "";
  e.target.reset();
  listarLancamentos();
  focoPrimeiro(lancamentos);
}

async function listarLancamentos() {
  const resp = await fetch(`${urlBase}/lancamentos.json`);
  const dados = await resp.json() || {};
  const respFunc = await fetch(`${urlBase}/funcionarios.json`);
  const funcs = await respFunc.json() || {};
  let html = "<table><tr><th>Funcion√°rio</th><th>Data</th><th>Valor</th><th>A√ß√µes</th></tr>";
  for (const [id, l] of Object.entries(dados)) {
    html += `<tr>
      <td>${funcs[l.func]?.nome || "?"}</td>
      <td>${l.data}</td>
      <td>R$ ${l.valor.toFixed(2)}</td>
      <td>
        <button onclick="editarLanc('${id}')">‚úèÔ∏è</button>
        <button onclick="excluirLanc('${id}')">üóëÔ∏è</button>
      </td>
    </tr>`;
  }
  html += "</table>";
  listaLanc.innerHTML = html;
}

async function editarLanc(id) {
  const resp = await fetch(`${urlBase}/lancamentos/${id}.json`);
  const l = await resp.json();
  idLanc.value = id;
  funcLanc.value = l.func;
  dataLanc.value = l.data;
  valorLanc.value = l.valor;
  focoPrimeiro(lancamentos);
}

async function excluirLanc(id) {
  if (!confirm("Excluir lan√ßamento?")) return;
  await fetch(`${urlBase}/lancamentos/${id}.json`, { method: "DELETE" });
  listarLancamentos();
}

/* === PDF === */
async function gerarPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.text("Relat√≥rio de Lan√ßamentos", 10, 10);

  const resp = await fetch(`${urlBase}/lancamentos.json`);
  const lanc = await resp.json() || {};
  const respFunc = await fetch(`${urlBase}/funcionarios.json`);
  const funcs = await respFunc.json() || {};

  let y = 20, totalGeral = 0;
  for (const l of Object.values(lanc)) {
    const nome = funcs[l.func]?.nome || "?";
    const linha = `${nome} - ${l.data} - R$ ${l.valor.toFixed(2)}`;
    doc.text(linha, 10, y);
    y += 8;
    totalGeral += l.valor;
  }
  doc.text(`Total Geral: R$ ${totalGeral.toFixed(2)}`, 10, y + 10);
  doc.save("relatorio.pdf");
}

/* === ENTER MUDA DE CAMPO === */
document.addEventListener("keydown", function(e) {
  if (e.key === "Enter") {
    const inputs = Array.from(document.querySelectorAll("input, select, textarea, button"));
    const atual = document.activeElement;
    const i = inputs.indexOf(atual);
    if (i > -1) {
      e.preventDefault();
      const proximo = inputs[i + 1];
      if (proximo) proximo.focus();
    }
  }
});

/* === FOCO AUTOM√ÅTICO INICIAL === */
window.onload = () => focoPrimeiro(login);
</script>
</body>
</html>
