<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Sistema de Funcionários</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #f4f4f4;
    margin: 0;
    padding: 0;
  }
  #loginContainer, #mainContainer {
    max-width: 600px;
    margin: 50px auto;
    background: #fff;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 0 10px rgba(0,0,0,0.2);
  }
  h2 {
    text-align: center;
    color: #333;
  }
  input, select, button {
    width: 100%;
    padding: 10px;
    margin: 6px 0;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 16px;
  }
  button {
    background-color: #007bff;
    color: white;
    border: none;
    cursor: pointer;
  }
  button:hover {
    background-color: #0056b3;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
  }
  th, td {
    padding: 8px;
    text-align: left;
    border-bottom: 1px solid #ddd;
  }
  .botoes {
    display: flex;
    justify-content: space-between;
    gap: 10px;
  }
</style>
</head>
<body>

<!-- Login -->
<div id="loginContainer">
  <h2>Login</h2>
  <input type="text" id="loginUsuario" placeholder="Usuário">
  <input type="password" id="loginSenha" placeholder="Senha">
  <button id="btnEntrar">Entrar</button>
</div>

<!-- Sistema -->
<div id="mainContainer" style="display:none;">
  <div class="botoes">
    <button id="btnCadastro">Cadastro</button>
    <button id="btnLancamento">Lançamento</button>
    <button id="btnPDF">Gerar PDF</button>
    <button id="btnSair">Sair</button>
  </div>

  <!-- Cadastro -->
  <div id="cadastroContainer">
    <h2>Cadastro de Funcionários</h2>
    <input id="nome" placeholder="Nome do Funcionário">
    <input id="cargo" placeholder="Cargo">
    <button id="btnSalvarCadastro">Salvar</button>
    <table id="tabelaCadastro">
      <thead><tr><th>Nome</th><th>Cargo</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Lançamentos -->
  <div id="lancamentoContainer" style="display:none;">
    <h2>Lançamento</h2>
    <select id="funcionarioSelect"></select>
    <select id="tipoLancamento">
      <option value="VALE">VALE</option>
      <option value="COMPRA">COMPRA</option>
    </select>
    <input id="valorLancamento" type="number" placeholder="Valor">
    <button id="btnSalvarLancamento">Salvar Lançamento</button>
    <table id="tabelaLancamento">
      <thead><tr><th>Funcionário</th><th>Tipo</th><th>Valor</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<!-- Firebase + Script -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";
  import { jsPDF } from "https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDH9MG50ynnt4SiXGAFymBH9nXmBqLwTtU",
    authDomain: "funcionarios-7c778.firebaseapp.com",
    databaseURL: "https://funcionarios-7c778-default-rtdb.firebaseio.com/",
    projectId: "funcionarios-7c778",
    storageBucket: "funcionarios-7c778.appspot.com",
    messagingSenderId: "632364021109",
    appId: "1:632364021109:web:fcfaf1de66901c8a8b4f3c"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const $ = id => document.getElementById(id);

  // Foco no login
  function focarLogin() { setTimeout(() => $('loginUsuario').focus(), 200); }
  window.addEventListener('load', focarLogin);

  // LOGIN
  $('btnEntrar').addEventListener('click', () => {
    const user = $('loginUsuario').value.trim();
    const pass = $('loginSenha').value.trim();
    if (user === "ADMIN" && pass === "1234") {
      $('loginContainer').style.display = "none";
      $('mainContainer').style.display = "block";
    } else {
      alert("Usuário ou senha incorretos!");
    }
  });

  $('btnSair').addEventListener('click', () => {
    $('mainContainer').style.display = "none";
    $('loginContainer').style.display = "block";
    $('loginUsuario').value = "";
    $('loginSenha').value = "";
    focarLogin();
  });

  // Alternar telas
  $('btnCadastro').addEventListener('click', () => {
    $('cadastroContainer').style.display = "block";
    $('lancamentoContainer').style.display = "none";
  });
  $('btnLancamento').addEventListener('click', () => {
    $('cadastroContainer').style.display = "none";
    $('lancamentoContainer').style.display = "block";
  });

  // CADASTRO
  $('btnSalvarCadastro').addEventListener('click', () => {
    const nome = $('nome').value.trim();
    const cargo = $('cargo').value.trim();
    if (!nome || !cargo) return alert("Preencha todos os campos!");
    push(ref(db, 'funcionarios'), { nome, cargo });
    $('nome').value = "";
    $('cargo').value = "";
  });

  onValue(ref(db, 'funcionarios'), snapshot => {
    const tbody = $('tabelaCadastro').querySelector('tbody');
    const select = $('funcionarioSelect');
    tbody.innerHTML = "";
    select.innerHTML = "";
    snapshot.forEach(child => {
      const f = child.val();
      tbody.innerHTML += `<tr><td>${f.nome}</td><td>${f.cargo}</td></tr>`;
      select.innerHTML += `<option>${f.nome}</option>`;
    });
  });

  // LANÇAMENTOS
  $('btnSalvarLancamento').addEventListener('click', () => {
    const nome = $('funcionarioSelect').value;
    const tipo = $('tipoLancamento').value;
    const valor = $('valorLancamento').value;
    if (!nome || !valor) return alert("Preencha todos os campos!");
    push(ref(db, 'lancamentos'), { nome, tipo, valor: parseFloat(valor) });
    $('valorLancamento').value = "";
  });

  onValue(ref(db, 'lancamentos'), snapshot => {
    const tbody = $('tabelaLancamento').querySelector('tbody');
    tbody.innerHTML = "";
    snapshot.forEach(child => {
      const l = child.val();
      tbody.innerHTML += `<tr><td>${l.nome}</td><td>${l.tipo}</td><td>R$ ${l.valor.toFixed(2)}</td></tr>`;
    });
  });

  // PDF
  $('btnPDF').addEventListener('click', () => {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.text("Relatório de Lançamentos", 70, 20);
    let y = 40;
    const linhas = document.querySelectorAll("#tabelaLancamento tbody tr");
    let total = 0;
    linhas.forEach(linha => {
      const cols = linha.querySelectorAll("td");
      const nome = cols[0].textContent;
      const tipo = cols[1].textContent;
      const valor = parseFloat(cols[2].textContent.replace("R$","").trim());
      total += valor;
      doc.text(`${nome} - ${tipo} - R$ ${valor.toFixed(2)}`, 10, y);
      y += 10;
    });
    doc.text(`Total Geral: R$ ${total.toFixed(2)}`, 10, y + 10);
    doc.save("lancamentos.pdf");
  });
</script>

</body>
</html>
