<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Cadastro Funcionário - Incluir no Firebase</title>
  <style>
    .hidden { display: none; }
  </style>
</head>
<body>

  <h2>Cadastro de Funcionário</h2>

  <button onclick="abrirInserir()">Incluir Funcionário</button>

  <div id="inserir" class="hidden">
    <h3>Inserir Funcionário</h3>
    <input type="hidden" id="idEditando" />
    <label>Nome: <input type="text" id="nome" /></label><br><br>
    <label>Cargo: <input type="text" id="cargo" /></label><br><br>
    <button onclick="salvarCadastro()">Salvar</button>
    <button onclick="voltarCadastro()">Cancelar</button>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getDatabase, ref, push, set, update } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    // Config do Firebase - use a sua
    const firebaseConfig = {
      apiKey: "AIzaSyDH9MG50ynnt4SiXGAFymBH9nXmBqLwTtU",
      authDomain: "funcionarios-7c778.firebaseapp.com",
      databaseURL: "https://funcionarios-7c778-default-rtdb.firebaseio.com",
      projectId: "funcionarios-7c778",
      storageBucket: "funcionarios-7c778.appspot.com",
      messagingSenderId: "632364021109",
      appId: "1:632364021109:web:fcfaf1de66901c8a8b4f3c",
      measurementId: "G-46DKFS3LHV"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Elementos DOM
    const inserirDiv = document.getElementById('inserir');
    const idEditandoInput = document.getElementById('idEditando');
    const nomeInput = document.getElementById('nome');
    const cargoInput = document.getElementById('cargo');

    function abrirInserir() {
      inserirDiv.classList.remove('hidden');
      limparCamposCadastro();
      nomeInput.focus();
    }

    function limparCamposCadastro() {
      idEditandoInput.value = '';
      nomeInput.value = '';
      cargoInput.value = '';
    }

    function voltarCadastro() {
      inserirDiv.classList.add('hidden');
      limparCamposCadastro();
    }

    async function salvarCadastro() {
      const nome = nomeInput.value.trim();
      const cargo = cargoInput.value.trim();
      const idEditando = idEditandoInput.value;

      if (!nome || !cargo) {
        alert("Preencha todos os campos.");
        return;
      }

      const cadRef = ref(db, 'cadastros');

      try {
        if (idEditando) {
          // Atualizar funcionário existente
          await update(ref(db, `cadastros/${idEditando}`), { nome, cargo });
          alert('Cadastro atualizado com sucesso!');
        } else {
          // Inserir novo funcionário
          const novoRef = push(cadRef);
          await set(novoRef, { nome, cargo });
          alert('Funcionário incluído com sucesso!');
        }
        voltarCadastro();
      } catch (error) {
        alert('Erro ao salvar no Firebase: ' + error.message);
      }
    }
  </script>
</body>
</html>
