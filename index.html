<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<script>
  // CONFIG FIREBASE
  const firebaseConfig = {
    apiKey: "AIzaSyBQi6DKYqEmkMq19UpgXl1qYg8G3q8Id-w",
    authDomain: "funcionarios-b75f8.firebaseapp.com",
    projectId: "funcionarios-b75f8",
    storageBucket: "funcionarios-b75f8.firebasestorage.app",
    messagingSenderId: "486091546093",
    appId: "1:486091546093:web:4cfa5518f209e5e68edbe4",
    measurementId: "G-R2SYT938ZG"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const elLogin = document.getElementById('login');
  const elMenu = document.getElementById('menu');
  const elCadastroMenu = document.getElementById('cadastroMenu');
  const elCadastroForm = document.getElementById('cadastroForm');
  const elConsulta = document.getElementById('consulta');

  const usuarioInput = document.getElementById('usuario');
  const senhaInput = document.getElementById('senha');
  const btnLogin = document.getElementById('btnLogin');
  const btnAbrirCadastro = document.getElementById('btnAbrirCadastro');
  const btnSair = document.getElementById('btnSair');

  const btnInserir = document.getElementById('btnInserir');
  const btnConsultar = document.getElementById('btnConsultar');
  const btnVoltarMenu = document.getElementById('btnVoltarMenu');

  const formTitulo = document.getElementById('formTitulo');
  const idEditandoInput = document.getElementById('idEditando');
  const nomeInput = document.getElementById('nome');
  const cargoInput = document.getElementById('cargo');
  const btnSalvar = document.getElementById('btnSalvar');
  const btnVoltarCadastro = document.getElementById('btnVoltarCadastro');

  const listaCadastros = document.getElementById('listaCadastros');
  const btnVoltarConsulta = document.getElementById('btnVoltarConsulta');

  // Fun√ß√£o para esconder telas
  function esconderTudo() {
    [elLogin, elMenu, elCadastroMenu, elCadastroForm, elConsulta].forEach(e => e.classList.add('hidden'));
  }

  // LOGIN
  usuarioInput.addEventListener('keydown', e => {
    if (e.key === 'Enter') { e.preventDefault(); senhaInput.focus(); }
  });
  senhaInput.addEventListener('keydown', e => {
    if (e.key === 'Enter') { e.preventDefault(); btnLogin.click(); }
  });
  btnLogin.addEventListener('click', () => {
    const user = usuarioInput.value.trim().toUpperCase();
    const pass = senhaInput.value.trim();
    if (user === 'ADMIN' && pass === '1234') {
      esconderTudo();
      elMenu.classList.remove('hidden');
    } else {
      alert('Usu√°rio ou senha incorretos!');
      usuarioInput.focus();
    }
  });
  btnSair.addEventListener('click', () => location.reload());

  // MENU ‚Üí CADASTRO
  btnAbrirCadastro.addEventListener('click', () => {
    esconderTudo();
    elCadastroMenu.classList.remove('hidden');
  });
  btnVoltarMenu.addEventListener('click', () => {
    esconderTudo();
    elMenu.classList.remove('hidden');
  });

  // INSERIR
  btnInserir.addEventListener('click', () => {
    formTitulo.textContent = 'INSERIR FUNCION√ÅRIO';
    idEditandoInput.value = '';
    nomeInput.value = '';
    cargoInput.value = '';
    esconderTudo();
    elCadastroForm.classList.remove('hidden');
    nomeInput.focus();
  });
  btnVoltarCadastro.addEventListener('click', () => {
    esconderTudo();
    elCadastroMenu.classList.remove('hidden');
  });

  // Salvar no Firestore
  async function salvarCadastro() {
    const nome = nomeInput.value.trim();
    const cargo = cargoInput.value.trim();
    if (!nome || !cargo) {
      alert('Preencha todos os campos!');
      nomeInput.focus();
      return;
    }

    const idEditando = idEditandoInput.value;
    try {
      if (idEditando) {
        await db.collection('funcionarios').doc(idEditando).update({ nome, cargo });
        alert('Funcion√°rio atualizado!');
      } else {
        await db.collection('funcionarios').add({ nome, cargo });
        alert('Funcion√°rio inserido!');
      }
      // Limpa os campos ap√≥s salvar
      idEditandoInput.value = '';
      nomeInput.value = '';
      cargoInput.value = '';
      nomeInput.focus();
    } catch (err) {
      alert('Erro ao salvar: ' + err.message);
      console.error(err);
    }
  }

  // Bot√£o salvar
  btnSalvar.addEventListener('click', e => {
    e.preventDefault();
    salvarCadastro();
  });

  // ENTER navega√ß√£o e salvar autom√°tico
  nomeInput.addEventListener('keydown', e => {
    if (e.key === 'Enter') { e.preventDefault(); cargoInput.focus(); }
  });
  cargoInput.addEventListener('keydown', e => {
    if (e.key === 'Enter') { e.preventDefault(); salvarCadastro(); }
  });

  // CONSULTAR
  btnConsultar.addEventListener('click', listarFuncionarios);
  btnVoltarConsulta.addEventListener('click', () => {
    esconderTudo();
    elCadastroMenu.classList.remove('hidden');
  });

  async function listarFuncionarios() {
    esconderTudo();
    elConsulta.classList.remove('hidden');
    listaCadastros.innerHTML = '';
    const snap = await db.collection('funcionarios').orderBy('nome').get();
    snap.forEach(doc => {
      const d = doc.data();
      const div = document.createElement('div');
      div.className = 'item';
      const span = document.createElement('span');
      span.textContent = `${d.nome} - ${d.cargo}`;
      span.style.cursor = 'pointer';
      span.ondblclick = () => editarFuncionario(doc.id);
      const btnDel = document.createElement('button');
      btnDel.className = 'btn-excluir';
      btnDel.textContent = 'üóëÔ∏è';
      btnDel.onclick = async () => {
        if (confirm('Excluir este funcion√°rio?')) {
          await db.collection('funcionarios').doc(doc.id).delete();
          listarFuncionarios();
        }
      };
      div.appendChild(span);
      div.appendChild(btnDel);
      listaCadastros.appendChild(div);
    });
  }

  async function editarFuncionario(id) {
    const docSnap = await db.collection('funcionarios').doc(id).get();
    if (!docSnap.exists) return alert('Registro n√£o encontrado');
    const d = docSnap.data();
    formTitulo.textContent = 'EDITAR FUNCION√ÅRIO';
    idEditandoInput.value = id;
    nomeInput.value = d.nome || '';
    cargoInput.value = d.cargo || '';
    esconderTudo();
    elCadastroForm.classList.remove('hidden');
    nomeInput.focus();
  }
</script>
