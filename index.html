<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Funcion√°rios - Firebase</title>

<!-- Estilo -->
<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f4f4;
  margin: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  text-transform: uppercase;
}
.container {
  background: white;
  padding: 25px;
  border-radius: 12px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  text-align: center;
  width: 100%;
  max-width: 380px;
}
input, select, button {
  width: 100%;
  padding: 10px;
  margin: 6px 0;
  border-radius: 6px;
  border: 1px solid #ccc;
  font-size: 16px;
  text-transform: uppercase;
}
button {
  background: #007bff;
  color: white;
  border: none;
  cursor: pointer;
}
button:hover { background: #0056b3; }
.btn-voltar { background: #6c757d; }
.btn-voltar:hover { background: #565e64; }
.hidden { display: none; }
.lista { text-align: left; margin-top: 10px; max-height: 250px; overflow-y: auto; }
.item {
  display: flex; justify-content: space-between; align-items: center;
  background: #f1f3f5; padding: 6px 8px; border-radius: 6px; margin: 4px 0;
}
.btn-excluir {
  width: 28px; height: 28px; background: #dc3545; color: white;
  border: none; border-radius: 50%; cursor: pointer;
}
.btn-excluir:hover { background: #b02a37; }
</style>

<!-- Firebase SDKs -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBQi6DKYqEmkMq19UpgXl1qYg8G3q8Id-w",
  authDomain: "funcionarios-b75f8.firebaseapp.com",
  projectId: "funcionarios-b75f8",
  storageBucket: "funcionarios-b75f8.firebasestorage.app",
  messagingSenderId: "486091546093",
  appId: "1:486091546093:web:4cfa5518f209e5e68edbe4",
  measurementId: "G-R2SYT938ZG"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// --- LOGIN ---
const loginDiv = document.getElementById('login');
const menuDiv = document.getElementById('menu');
const cadastroMenu = document.getElementById('cadastroMenu');
const cadastroForm = document.getElementById('cadastroForm');
const consultaCadastro = document.getElementById('consultaCadastro');

// foco no usu√°rio
window.onload = () => { document.getElementById('usuario').focus(); };

document.addEventListener('keydown', e => {
  if (e.key === 'Enter') {
    const el = e.target;
    if (el.tagName === 'INPUT') {
      e.preventDefault();
      const next = el.parentElement.querySelectorAll('input,button');
      const index = Array.from(next).indexOf(el);
      if (next[index+1]) next[index+1].focus();
      else el.form?.requestSubmit();
    }
  }
});

window.fazerLogin = function() {
  const user = document.getElementById('usuario').value.toUpperCase();
  const senha = document.getElementById('senha').value;
  if (user === 'ADMIN' && senha === '1234') {
    loginDiv.classList.add('hidden');
    menuDiv.classList.remove('hidden');
  } else {
    alert('Usu√°rio ou senha incorretos!');
    document.getElementById('usuario').focus();
  }
};

window.sair = function() {
  location.reload();
};

// --- CADASTRO ---
window.abrirCadastro = function() {
  menuDiv.classList.add('hidden');
  cadastroMenu.classList.remove('hidden');
};

window.voltarMenu = function() {
  cadastroMenu.classList.add('hidden');
  menuDiv.classList.remove('hidden');
};

// Inserir
window.abrirInserir = function() {
  cadastroMenu.classList.add('hidden');
  cadastroForm.classList.remove('hidden');
};

window.voltarCadastro = function() {
  cadastroForm.classList.add('hidden');
  cadastroMenu.classList.remove('hidden');
};

// Salvar funcion√°rio
window.salvarCadastro = async function() {
  const nome = document.getElementById('nome').value.trim();
  const cargo = document.getElementById('cargo').value.trim();
  const idEditando = document.getElementById('idEditando').value;
  if (!nome || !cargo) return alert('Preencha todos os campos!');
  if (idEditando) {
    await updateDoc(doc(db, "funcionarios", idEditando), { nome, cargo });
    alert("Funcion√°rio atualizado!");
  } else {
    await addDoc(collection(db, "funcionarios"), { nome, cargo });
    alert("Funcion√°rio inserido!");
  }
  document.getElementById('idEditando').value = '';
  document.getElementById('nome').value = '';
  document.getElementById('cargo').value = '';
};

// Consultar
window.abrirConsultar = async function() {
  cadastroMenu.classList.add('hidden');
  consultaCadastro.classList.remove('hidden');
  await listarFuncionarios();
};

window.voltarConsulta = function() {
  consultaCadastro.classList.add('hidden');
  cadastroMenu.classList.remove('hidden');
};

// Listar e editar
async function listarFuncionarios() {
  const lista = document.getElementById('listaCadastros');
  lista.innerHTML = '';
  const query = await getDocs(collection(db, "funcionarios"));
  query.forEach(docu => {
    const data = docu.data();
    const div = document.createElement('div');
    div.className = 'item';
    div.innerHTML = `
      <span ondblclick="editarFuncionario('${docu.id}', '${data.nome}', '${data.cargo}')">
        ${data.nome} - ${data.cargo}
      </span>
      <button class="btn-excluir" onclick="excluirFuncionario('${docu.id}')">üóëÔ∏è</button>
    `;
    lista.appendChild(div);
  });
}

window.editarFuncionario = function(id, nome, cargo) {
  consultaCadastro.classList.add('hidden');
  cadastroForm.classList.remove('hidden');
  document.getElementById('idEditando').value = id;
  document.getElementById('nome').value = nome;
  document.getElementById('cargo').value = cargo;
};

window.excluirFuncionario = async function(id) {
  if (confirm('Excluir este funcion√°rio?')) {
    await deleteDoc(doc(db, "funcionarios", id));
    listarFuncionarios();
  }
};
</script>
</head>

<body>
<!-- LOGIN -->
<div class="container" id="login">
  <h2>Login</h2>
  <input id="usuario" type="text" placeholder="Usu√°rio" />
  <input id="senha" type="password" placeholder="Senha" />
  <button onclick="fazerLogin()">Entrar</button>
</div>

<!-- MENU -->
<div class="container hidden" id="menu">
  <h2>Menu Principal</h2>
  <button onclick="abrirCadastro()">Cadastro</button>
  <button disabled>Lan√ßamento (em breve)</button>
  <button onclick="sair()">Sair</button>
</div>

<!-- MENU CADASTRO -->
<div class="container hidden" id="cadastroMenu">
  <h2>Cadastro</h2>
  <button onclick="abrirInserir()">Inserir</button>
  <button onclick="abrirConsultar()">Consultar</button>
  <button class="btn-voltar" onclick="voltarMenu()">Voltar</button>
</div>

<!-- INSERIR -->
<div class="container hidden" id="cadastroForm">
  <h2>Inserir / Editar Funcion√°rio</h2>
  <input type="hidden" id="idEditando" />
  <input id="nome" type="text" placeholder="Nome" />
  <input id="cargo" type="text" placeholder="Cargo" />
  <button onclick="salvarCadastro()">Salvar</button>
  <button class="btn-voltar" onclick="voltarCadastro()">Voltar</button>
</div>

<!-- CONSULTAR -->
<div class="container hidden" id="consultaCadastro">
  <h2>Consultar Funcion√°rios</h2>
  <div id="listaCadastros" class="lista"></div>
  <button class="btn-voltar" onclick="voltarConsulta()">Voltar</button>
</div>
</body>
</html>
