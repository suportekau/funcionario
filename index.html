<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Sistema Simples - Funcion√°rios (Firebase)</title>
<style>
  /* Visual igual ao seu, por√©m responsivo */
  body {
    font-family: Arial, sans-serif;
    background-color: #f4f4f4;
    margin: 0;
    padding: 10px;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    text-transform: uppercase; /* mantem visual em mai√∫sculas */
    box-sizing: border-box;
  }

  .container {
    background: white;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    text-align: center;
    width: 100%;
    max-width: 380px;
    box-sizing: border-box;
  }

  h2 { margin-bottom: 20px; font-size: 1.4em; }

  input, select, textarea {
    width: 100%;
    padding: 10px;
    margin: 5px 0;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-size: 16px;
    box-sizing: border-box;
    text-transform: uppercase; /* visual */
  }

  button {
    width: 100%;
    padding: 12px;
    margin: 8px 0;
    border: none;
    border-radius: 8px;
    background-color: #007bff;
    color: white;
    font-size: 16px;
    cursor: pointer;
    transition: background 0.2s;
  }

  button:hover { background-color: #0056b3; }
  .btn-voltar { background-color: #6c757d; }
  .btn-voltar:hover { background-color: #565e64; }

  .hidden { display: none; }

  .lista { text-align: left; margin-top: 10px; max-height: 300px; overflow-y: auto; }

  .item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: #f1f3f5;
    padding: 6px 8px;
    border-radius: 6px;
    margin: 4px 0;
    transition: background 0.2s;
  }
  .item:hover { background-color: #e0e3e7; }
  .btn-excluir {
    width: 28px; height: 28px; display:flex; align-items:center; justify-content:center;
    background-color:#dc3545; color:white; border:none; border-radius:50%; cursor:pointer;
    font-size:14px; flex-shrink:0; transition: background .2s, transform .1s;
  }
  .btn-excluir:hover{ background-color:#b02a37; transform: scale(1.1); }

  .row { display:flex; gap:8px; align-items:center; }
  .small { width:48%; }

  @media (max-width: 400px) {
    h2 { font-size: 1.2em; }
    button { font-size: 15px; padding: 10px; }
    input, select, textarea { font-size: 15px; padding: 8px; }
    .row { flex-direction: column; }
    .small { width:100%; }
  }
</style>

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>

<!-- LOGIN -->
<div class="container" id="loginContainer">
  <h2>Login</h2>
  <input type="text" id="loginUsuario" placeholder="Usu√°rio" />
  <input type="password" id="loginSenha" placeholder="Senha" />
  <button id="btnEntrar" onclick="fazerLogin()">Entrar</button>
</div>

<!-- MENU PRINCIPAL -->
<div class="container hidden" id="menu">
  <h2>Menu Principal</h2>
  <button onclick="abrirCadastro()">Cadastro</button>
  <button onclick="abrirLancamento()">Lan√ßamento</button>
  <button onclick="sair()">Sair</button>
</div>

<!-- MENU CADASTRO -->
<div class="container hidden" id="menuCadastro">
  <h2>Cadastro</h2>
  <button onclick="abrirInserir()">Inserir</button>
  <button onclick="abrirConsultar()">Consultar</button>
  <button class="btn-voltar" onclick="voltar()">Voltar</button>
</div>

<!-- INSERIR CADASTRO -->
<div class="container hidden" id="inserir">
  <h2>Inserir / Editar Funcion√°rio</h2>
  <input type="hidden" id="idEditando" />
  <input type="text" id="nome" placeholder="Nome" />
  <input type="text" id="cargo" placeholder="Cargo" />
  <button id="btnSalvarCadastro" onclick="salvarCadastro()">Salvar</button>
  <button class="btn-voltar" onclick="voltarCadastro()">Voltar</button>
</div>

<!-- CONSULTAR CADASTRO -->
<div class="container hidden" id="consultar">
  <h2>Consultar Funcion√°rios</h2>
  <input type="text" id="filtro" placeholder="Filtrar por nome" oninput="mostrarCadastros()" />
  <div class="lista" id="listaCadastros"></div>
  <button class="btn-voltar" onclick="voltarCadastro()">Voltar</button>
</div>

<!-- MENU LAN√áAMENTO -->
<div class="container hidden" id="menuLancamento">
  <h2>Lan√ßamento</h2>
  <button onclick="abrirInserirLancamento()">Inserir</button>
  <button onclick="abrirConsultarLancamento()">Consultar</button>
  <button class="btn-voltar" onclick="voltar()">Voltar</button>
</div>

<!-- INSERIR LAN√áAMENTO -->
<div class="container hidden" id="inserirLancamento">
  <h2>Inserir / Editar Lan√ßamento</h2>
  <input type="hidden" id="idLancEditando" />
  <input list="nomesCadastradosLanc" id="nomeLanc" placeholder="Nome do Funcion√°rio" />
  <datalist id="nomesCadastradosLanc"></datalist>
  <input type="date" id="dataLanc" />
  <select id="tipoLanc">
    <option value="">Selecione Tipo</option>
    <option value="VALE">VALE</option>
    <option value="COMPRA">COMPRA</option>
  </select>
  <input type="number" id="valorLanc" placeholder="Valor" step="0.01" />
  <button id="btnSalvarLanc" onclick="salvarLancamento()">Salvar</button>
  <button class="btn-voltar" onclick="voltarLancamento()">Voltar</button>
</div>

<!-- CONSULTAR LAN√áAMENTO -->
<div class="container hidden" id="consultarLancamento">
  <h2>Consultar Lan√ßamentos</h2>
  <input type="text" id="filtroLanc" placeholder="Filtrar por nome" oninput="mostrarLancamentos()" />
  <input type="month" id="filtroMesAno" onchange="mostrarLancamentos()" />
  <div class="lista" id="listaLancamentos"></div>
  <button id="btnGerarPDF" onclick="gerarPDFResumoLancamentos()">Gerar PDF</button>
  <button class="btn-voltar" onclick="voltarLancamento()">Voltar</button>
</div>

<!-- FIREBASE + L√ìGICA -->
<script type="module">
  // Firebase SDK imports
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import {
    getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc, query, where, orderBy
  } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  // -------------------------
  // Configura√ß√£o do Firebase
  // -------------------------
  const firebaseConfig = {
    apiKey: "AIzaSyDH9MG50ynnt4SiXGAFymBH9nXmBqLwTtU",
    authDomain: "funcionarios-7c778.firebaseapp.com",
    projectId: "funcionarios-7c778",
    storageBucket: "funcionarios-7c778.firebasestorage.app",
    messagingSenderId: "632364021109",
    appId: "1:632364021109:web:f140b97a8dbc36148b4f3c",
    measurementId: "G-2JXX10SBVG"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // -------------------------
  // Utilit√°rios DOM
  // -------------------------
  const nomeInput = document.getElementById('nome');
  const cargoInput = document.getElementById('cargo');
  const idEditandoInput = document.getElementById('idEditando');

  const nomeLanc = document.getElementById('nomeLanc');
  const dataLanc = document.getElementById('dataLanc');
  const tipoLanc = document.getElementById('tipoLanc');
  const valorLanc = document.getElementById('valorLanc');
  const idLancEditando = document.getElementById('idLancEditando');

  // -------------------------
  // Foco inicial no Usu√°rio
  // -------------------------
  window.addEventListener('load', () => {
    const u = document.getElementById('loginUsuario');
    if (u) { u.focus(); u.select && u.select(); }
    // carregar lista inicial (opcional)
    // mostrarCadastros(); // s√≥ carrega quando abrir a tela de consultar
  });

  // -------------------------
  // Enter navigation (mantido)
  // -------------------------
  document.addEventListener('keydown', function(e) {
    if (e.key !== 'Enter') return;
    const interactive = Array.from(document.querySelectorAll('input, select, button'))
      .filter(el => el.offsetParent !== null && !el.disabled && el.type !== 'hidden');
    const target = e.target;
    const idx = interactive.indexOf(target);
    if (idx === -1) return;
    e.preventDefault();
    const nextIndex = idx + 1;
    if (nextIndex < interactive.length) {
      const next = interactive[nextIndex];
      next.focus();
    } else {
      const el = interactive[idx];
      if (el && typeof el.click === 'function') el.click();
    }
  });

  // -------------------------
  // Mai√∫sculas autom√°ticas
  // -------------------------
  document.addEventListener('input', function(e) {
    const el = e.target;
    if (!el) return;
    const tag = el.tagName.toLowerCase();
    if (tag === 'input') {
      const t = el.type;
      if (t === 'text' || t === 'search' || t === 'tel' || t === 'email') {
        const pos = el.selectionStart;
        el.value = el.value.toUpperCase();
        try { el.setSelectionRange(pos, pos); } catch(err){}
      }
    } else if (tag === 'textarea') {
      const pos = el.selectionStart;
      el.value = el.value.toUpperCase();
      try { el.setSelectionRange(pos, pos); } catch(err){}
    }
  });

  // -------------------------
  // Navega√ß√£o entre telas
  // -------------------------
  function esconderTudo(){ document.querySelectorAll('.container').forEach(div=>div.classList.add('hidden')); }
  window.abrirCadastro = function(){ esconderTudo(); document.getElementById('menuCadastro').classList.remove('hidden'); }
  window.abrirLancamento = function(){ esconderTudo(); document.getElementById('menuLancamento').classList.remove('hidden'); }
  window.voltar = function(){ esconderTudo(); document.getElementById('menu').classList.remove('hidden'); }
  window.voltarCadastro = function(){ esconderTudo(); document.getElementById('menuCadastro').classList.remove('hidden'); }
  window.voltarLancamento = function(){ esconderTudo(); document.getElementById('menuLancamento').classList.remove('hidden'); }
  window.sair = function(){ alert('Saindo do sistema...'); location.reload(); }

  // -------------------------
  // LOGIN (ADMIN / 1234)
  // -------------------------
  window.fazerLogin = function(){
    const usuario = (document.getElementById('loginUsuario').value || '').trim().toUpperCase();
    const senha = (document.getElementById('loginSenha').value || '').trim();
    if (usuario === 'ADMIN' && senha === '1234') {
      document.getElementById('loginContainer').classList.add('hidden');
      document.getElementById('menu').classList.remove('hidden');
      alert('Login bem-sucedido!');
      const btn = document.querySelector('#menu button');
      if (btn) btn.focus();
    } else {
      alert('Usu√°rio ou senha incorretos!');
      const u = document.getElementById('loginUsuario'); if(u){ u.focus(); u.select && u.select(); }
    }
  }

  // -------------------------
  // CADASTROS (Firestore)
  // -------------------------
  window.abrirInserir = function(){ esconderTudo(); document.getElementById('inserir').classList.remove('hidden'); limparCamposCadastro(); }
  window.abrirConsultar = function(){ esconderTudo(); document.getElementById('consultar').classList.remove('hidden'); mostrarCadastros(); }

  window.salvarCadastro = async function(){
    const nome = (nomeInput.value || '').trim();
    const cargo = (cargoInput.value || '').trim();
    if(!nome || !cargo) return alert('Preencha todos os campos.');
    try {
      const idEditando = idEditandoInput.value;
      if (idEditando) {
        // atualizar doc
        const d = doc(db, "cadastros", idEditando);
        await updateDoc(d, { nome, cargo, atualizadoEm: new Date().toISOString() });
      } else {
        await addDoc(collection(db, "cadastros"), { nome, cargo, criadoEm: new Date().toISOString() });
      }
      limparCamposCadastro();
      voltarCadastro();
    } catch (err) {
      console.error("Erro salvar cadastro:", err);
      alert("Erro ao salvar no Firebase.");
    }
  }

  window.mostrarCadastros = async function(){
    const lista = document.getElementById('listaCadastros');
    const filtro = (document.getElementById('filtro').value || '').trim().toUpperCase();
    lista.innerHTML = '';
    try {
      const q = collection(db, "cadastros");
      const snap = await getDocs(q);
      const docs = [];
      snap.forEach(d => docs.push({ id: d.id, ...d.data() }));
      let cadastros = docs.sort((a,b)=> (a.nome||'').localeCompare(b.nome||''));
      if (filtro) cadastros = cadastros.filter(c => (c.nome||'').toUpperCase().includes(filtro));
      if (cadastros.length === 0) {
        lista.innerHTML = '<div style="opacity:.7;padding:8px">Nenhum cadastro encontrado</div>';
        return;
      }
      cadastros.forEach(c => {
        const div = document.createElement('div');
        div.className = 'item';
        div.innerHTML = `<span ondblclick="editarCadastro('${c.id}')"><strong>${c.nome}</strong> - ${c.cargo}</span>
          <div style="display:flex; gap:6px;">
            <button class="btn-excluir" onclick="excluirCadastro('${c.id}')" title="Excluir">üóëÔ∏è</button>
          </div>`;
        lista.appendChild(div);
      });
    } catch (err) {
      console.error("Erro listar cadastros:", err);
      lista.innerHTML = '<div style="color:red;padding:8px">Erro ao carregar cadastros</div>';
    }
  }

  window.editarCadastro = async function(id){
    try {
      const dRef = doc(db, "cadastros", id);
      const snap = await getDocs(collection(db, "cadastros")); // fallback to avoid extra getDoc import
      // We'll find in bulk snap (we already load list in mostrarCadastros usually)
      // But to be safe, try to read the specific doc by iterating loaded docs:
      let found = null;
      snap.forEach(s => { if (s.id === id) found = s.data(); });
      if (!found) {
        // try fetch single doc via getDocs of query
        // (we already have all docs but if not found, show message)
        alert('Cadastro n√£o encontrado localmente.');
        return;
      }
      esconderTudo(); document.getElementById('inserir').classList.remove('hidden');
      idEditandoInput.value = id;
      nomeInput.value = found.nome || '';
      cargoInput.value = found.cargo || '';
    } catch (err) {
      console.error("Erro editar cadastro:", err);
      alert('Erro ao carregar cadastro para edi√ß√£o.');
    }
  }

  window.excluirCadastro = async function(id){
    if(!confirm('Excluir este cadastro?')) return;
    try {
      await deleteDoc(doc(db, "cadastros", id));
      // Tamb√©m remover lan√ßamentos relacionados? (n√£o autom√°tico aqui)
      mostrarCadastros();
    } catch (err) {
      console.error("Erro excluir cadastro:", err);
      alert('Erro ao excluir cadastro.');
    }
  }

  function limparCamposCadastro(){ idEditandoInput.value=''; nomeInput.value=''; cargoInput.value=''; }

  // -------------------------
  // LAN√áAMENTOS (Firestore)
  // -------------------------
  window.abrirInserirLancamento = async function(){
    // verificar se existem cadastros
    try {
      const snapCad = await getDocs(collection(db, "cadastros"));
      if (snapCad.empty) {
        alert('Nenhum funcion√°rio cadastrado. Cadastre antes de lan√ßar.');
        abrirCadastro();
        return;
      }
      esconderTudo(); document.getElementById('inserirLancamento').classList.remove('hidden');
      limparCamposLancamento();
      atualizarDatalistLanc();
    } catch (err) {
      console.error("Erro abrir inserir lan√ßamento:", err);
      alert('Erro ao acessar cadastros.');
    }
  }

  window.abrirConsultarLancamento = function(){ esconderTudo(); document.getElementById('consultarLancamento').classList.remove('hidden'); mostrarLancamentos(); }

  window.salvarLancamento = async function(){
    const nome = (nomeLanc.value || '').trim().toUpperCase();
    const data = dataLanc.value;
    const tipo = tipoLanc.value;
    const valor = parseFloat(valorLanc.value);
    if(!nome || !data || !tipo || isNaN(valor)) return alert('Preencha todos os campos corretamente.');
    try {
      // verificar nome cadastrado
      const snap = await getDocs(collection(db, "cadastros"));
      const exists = [];
      snap.forEach(s => { if ((s.data().nome || '').toUpperCase() === nome) exists.push(s.id); });
      if (!exists.length) return alert('Nome n√£o cadastrado. Cadastre antes de lan√ßar.');

      const idEdit = idLancEditando.value;
      if (idEdit) {
        await updateDoc(doc(db, "lancamentos", idEdit), { nome, data, tipo, valor, atualizadoEm: new Date().toISOString() });
      } else {
        await addDoc(collection(db, "lancamentos"), { nome, data, tipo, valor, criadoEm: new Date().toISOString() });
      }
      limparCamposLancamento();
      voltarLancamento();
    } catch (err) {
      console.error("Erro salvar lan√ßamento:", err);
      alert('Erro ao salvar lan√ßamento no Firebase.');
    }
  }

  window.mostrarLancamentos = async function(){
    const lista = document.getElementById('listaLancamentos');
    const filtroNome = (document.getElementById('filtroLanc').value || '').trim().toUpperCase();
    const filtroMesAno = document.getElementById('filtroMesAno').value; // formato yyyy-mm
    lista.innerHTML = '';
    try {
      const snap = await getDocs(collection(db, "lancamentos"));
      const docs = [];
      snap.forEach(d => docs.push({ id: d.id, ...d.data() }));
      let lancamentos = docs.sort((a,b)=> {
        if (!a.data) return 1;
        if (!b.data) return -1;
        return (b.data || '').localeCompare(a.data || '');
      });
      if (filtroNome) lancamentos = lancamentos.filter(l => (l.nome||'').toUpperCase().includes(filtroNome));
      if (filtroMesAno) lancamentos = lancamentos.filter(l => (l.data||'').startsWith(filtroMesAno));
      if (lancamentos.length === 0) {
        lista.innerHTML = '<div style="opacity:.7;padding:8px">Nenhum lan√ßamento encontrado</div>';
        return;
      }
      lancamentos.forEach(l => {
        const div = document.createElement('div');
        div.className = 'item';
        const valorFormat = (typeof l.valor === 'number') ? l.valor.toFixed(2).replace('.', ',') : (l.valor || '0,00');
        div.innerHTML = `<span ondblclick="editarLancamento('${l.id}')"><strong>${l.id} - ${l.nome}</strong> | ${l.data} | ${l.tipo} | R$ ${valorFormat}</span>
          <div style="display:flex; gap:6px;">
            <button class="btn-excluir" onclick="excluirLancamento('${l.id}')">üóëÔ∏è</button>
          </div>`;
        lista.appendChild(div);
      });
    } catch (err) {
      console.error("Erro listar lan√ßamentos:", err);
      lista.innerHTML = '<div style="color:red;padding:8px">Erro ao carregar lan√ßamentos</div>';
    }
  }

  window.editarLancamento = async function(id){
    try {
      const snap = await getDocs(collection(db, "lancamentos"));
      let found = null;
      snap.forEach(s => { if (s.id === id) found = s.data(); });
      if (!found) { alert('Lan√ßamento n√£o encontrado'); return; }
      esconderTudo(); document.getElementById('inserirLancamento').classList.remove('hidden');
      idLancEditando.value = id;
      nomeLanc.value = found.nome || '';
      dataLanc.value = found.data || '';
      tipoLanc.value = found.tipo || '';
      valorLanc.value = found.valor || '';
    } catch (err) {
      console.error("Erro editar lan√ßamento:", err);
      alert('Erro ao carregar lan√ßamento para edi√ß√£o.');
    }
  }

  window.excluirLancamento = async function(id){
    if(!confirm('Excluir este lan√ßamento?')) return;
    try {
      await deleteDoc(doc(db, "lancamentos", id));
      mostrarLancamentos();
    } catch (err) {
      console.error("Erro excluir lan√ßamento:", err);
      alert('Erro ao excluir lan√ßamento.');
    }
  }

  function limparCamposLancamento(){
    idLancEditando.value=''; nomeLanc.value=''; dataLanc.value=''; tipoLanc.value=''; valorLanc.value='';
  }

  window.atualizarDatalistLanc = async function(){
    const datalist = document.getElementById('nomesCadastradosLanc');
    datalist.innerHTML = '';
    try {
      const snap = await getDocs(collection(db, "cadastros"));
      const names = [];
      snap.forEach(s => { const d = s.data(); if (d && d.nome) names.push(d.nome); });
      names.sort();
      names.forEach(n => {
        const opt = document.createElement('option'); opt.value = n; datalist.appendChild(opt);
      });
    } catch (err) {
      console.error("Erro atualizar datalist:", err);
    }
  }

  // -------------------------
  // GERAR PDF - lendo Firestore
  // -------------------------
  window.gerarPDFResumoLancamentos = async function(){
    try {
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF();
      const pageWidth = pdf.internal.pageSize.getWidth();

      // Cabe√ßalho
      pdf.setFontSize(14);
      pdf.setFont("helvetica", "bold");
      const titulo = "RESUMO DE LAN√áAMENTOS";
      const tituloWidth = pdf.getTextWidth(titulo);
      pdf.text(titulo, (pageWidth - tituloWidth) / 2, 15);

      const agora = new Date();
      const dataHoraStr = agora.toLocaleString('pt-BR', { dateStyle: 'short', timeStyle: 'short' });
      pdf.setFontSize(10);
      pdf.setFont("helvetica", "normal");
      pdf.text(dataHoraStr, 10, 22);

      const filtroMesAno = document.getElementById('filtroMesAno').value;
      if (filtroMesAno) {
        const [ano, mes] = filtroMesAno.split('-');
        const periodoStr = `Per√≠odo: ${mes}/${ano}`;
        const periodoWidth = pdf.getTextWidth(periodoStr);
        pdf.text(periodoStr, (pageWidth - periodoWidth) / 2, 22);
      }

      pdf.line(10, 25, pageWidth - 10, 25);

      // Conte√∫do
      let y = 35;
      pdf.setFontSize(12);
      pdf.setFont("helvetica", "bold");
      pdf.text("DETALHE POR NOME", 10, y);
      y += 10;

      // Buscar lan√ßamentos
      const snap = await getDocs(collection(db, "lancamentos"));
      const lanc = [];
      snap.forEach(s => lanc.push(s.data()));
      let lancamentos = lanc;
      if (filtroMesAno) lancamentos = lancamentos.filter(l => (l.data||'').startsWith(filtroMesAno));

      const resumo = {};
      lancamentos.forEach(l => {
        const nomeUp = (l.nome || '').toUpperCase();
        resumo[nomeUp] = (resumo[nomeUp] || 0) + (parseFloat(l.valor) || 0);
      });

      pdf.setFont("helvetica", "normal");
      const nomesOrdenados = Object.keys(resumo).sort();

      if (nomesOrdenados.length === 0) {
        pdf.text("Nenhum lan√ßamento para o per√≠odo.", 10, y);
      } else {
        nomesOrdenados.forEach(nome => {
          const valorFormatado = "R$ " + resumo[nome].toFixed(2).replace('.', ',');
          const leftX = 10;
          const rightX = pageWidth - 10;
          const nomeWidth = pdf.getTextWidth(nome);
          const valorWidth = pdf.getTextWidth(valorFormatado);
          const totalDotsWidth = rightX - leftX - nomeWidth - valorWidth - 8;
          const dotWidth = pdf.getTextWidth('.');
          const dotsCount = Math.floor(totalDotsWidth / dotWidth);
          const dots = '.'.repeat(dotsCount > 0 ? dotsCount : 3);

          const linha = `${nome} ${dots} ${valorFormatado}`;
          pdf.text(linha, leftX, y);
          y += 8;
          if (y > 280) { pdf.addPage(); y = 20; }
        });
      }

      // Total geral
      const totalGeral = Object.values(resumo).reduce((a,b) => a + b, 0);
      const totalNome = "TOTAL GERAL";
      const totalValor = "R$ " + totalGeral.toFixed(2).replace('.', ',');
      const leftX = 10;
      const rightX = pageWidth - 10;
      const nomeWidth = pdf.getTextWidth(totalNome);
      const valorWidth = pdf.getTextWidth(totalValor);
      const totalDotsWidth = rightX - leftX - nomeWidth - valorWidth - 8;
      const dotWidth = pdf.getTextWidth('.');
      const dotsCount = Math.floor(totalDotsWidth / dotWidth);
      const dots = '.'.repeat(dotsCount > 0 ? dotsCount : 3);

      y += 10;
      pdf.setFont("helvetica", "bold");
      pdf.text(`${totalNome} ${dots} ${totalValor}`, leftX, y);

      pdf.save("RESUMO_LANCAMENTOS.pdf");
    } catch (err) {
      console.error("Erro gerar PDF:", err);
      alert('Erro ao gerar PDF.');
    }
  }

  // -------------------------
  // Alguns atalhos √∫teis
  // -------------------------
  // Expor fun√ß√µes para uso no HTML (j√° feito via window.* onde necess√°rio)
  // Nenhuma a√ß√£o cont√≠nua em background - apenas responde a cliques

</script>

</body>
</html>
