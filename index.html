<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Sistema Simples - Funcion√°rios (Firebase)</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #f4f4f4;
    margin: 0;
    padding: 10px;
    display: flex;
    justify-content: center;
  }
  .container {
    background: #fff;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 0 10px #ccc;
    width: 100%;
    max-width: 450px;
  }
  h2 {
    text-align: center;
    color: #333;
  }
  input, select, button {
    width: 100%;
    padding: 10px;
    margin: 6px 0;
    border: 1px solid #ccc;
    border-radius: 5px;
  }
  button {
    background-color: #007bff;
    color: white;
    border: none;
    cursor: pointer;
  }
  button:hover {
    background-color: #0056b3;
  }
  .menu button {
    width: 48%;
  }
  #lista, #listaLanc {
    margin-top: 10px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
  }
  th, td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: left;
  }
  th {
    background: #007bff;
    color: #fff;
  }
</style>
</head>
<body>
<div class="container" id="loginDiv">
  <h2>Login</h2>
  <input type="text" id="usuario" placeholder="Usu√°rio">
  <input type="password" id="senha" placeholder="Senha">
  <button onclick="login()">Entrar</button>
</div>

<div class="container" id="menuDiv" style="display:none">
  <h2>Menu Principal</h2>
  <div class="menu">
    <button onclick="abrirCadastro()">Cadastro</button>
    <button onclick="abrirLancamento()">Lan√ßamento</button>
  </div>
</div>

<div class="container" id="cadastroDiv" style="display:none">
  <h2>Cadastro de Funcion√°rios</h2>
  <input id="nome" placeholder="Nome">
  <input id="cargo" placeholder="Cargo">
  <button onclick="salvarFuncionario()">Salvar</button>
  <button onclick="mostrarFuncionarios()">Consultar</button>
  <div id="lista"></div>
  <button onclick="voltarMenu()">Voltar</button>
</div>

<div class="container" id="lancamentoDiv" style="display:none">
  <h2>Lan√ßamentos</h2>
  <input id="dataLanc" type="date">
  <input id="funcLanc" placeholder="Funcion√°rio">
  <input id="valorLanc" type="number" step="0.01" placeholder="Valor">
  <button onclick="salvarLancamento()">Salvar</button>
  <button onclick="mostrarLancamentos()">Consultar</button>
  <button onclick="gerarPDF()">Gerar PDF</button>
  <div id="listaLanc"></div>
  <button onclick="voltarMenu()">Voltar</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
const URL_FUNC = "https://funcionarios-7c778-default-rtdb.firebaseio.com/funcionarios.json";
const URL_LANC = "https://funcionarios-7c778-default-rtdb.firebaseio.com/lancamentos.json";

/* ---- LOGIN ---- */
function login() {
  const u = usuario.value.trim();
  const s = senha.value.trim();
  if (u === "ADMIN" && s === "1234") {
    loginDiv.style.display = "none";
    menuDiv.style.display = "block";
    setTimeout(()=>document.querySelector('#menuDiv button').focus(),100);
  } else {
    alert("Usu√°rio ou senha incorretos");
  }
}

/* ---- NAVEGA√á√ÉO ---- */
function abrirCadastro() {
  menuDiv.style.display = "none";
  cadastroDiv.style.display = "block";
  setTimeout(()=>document.getElementById("nome").focus(),100);
}
function abrirLancamento() {
  menuDiv.style.display = "none";
  lancamentoDiv.style.display = "block";
  setTimeout(()=>document.getElementById("dataLanc").focus(),100);
}
function voltarMenu() {
  cadastroDiv.style.display = "none";
  lancamentoDiv.style.display = "none";
  menuDiv.style.display = "block";
  setTimeout(()=>document.querySelector('#menuDiv button').focus(),100);
}

/* ---- FUNCION√ÅRIOS ---- */
async function salvarFuncionario() {
  const nome = document.getElementById('nome').value.trim();
  const cargo = document.getElementById('cargo').value.trim();
  if (!nome || !cargo) return alert("Preencha todos os campos!");
  const dados = { nome, cargo };
  await fetch(URL_FUNC, { method:"POST", body:JSON.stringify(dados) });
  alert("Funcion√°rio salvo!");
  nome.value = ""; cargo.value = "";
  nome.focus();
}
async function mostrarFuncionarios() {
  const resp = await fetch(URL_FUNC);
  const data = await resp.json();
  let html = "<table><tr><th>Nome</th><th>Cargo</th><th>A√ß√µes</th></tr>";
  for (let id in data) {
    html += `<tr>
      <td>${data[id].nome}</td>
      <td>${data[id].cargo}</td>
      <td>
        <button onclick="editarFuncionario('${id}','${data[id].nome}','${data[id].cargo}')">‚úèÔ∏è</button>
        <button onclick="excluirFuncionario('${id}')">üóëÔ∏è</button>
      </td></tr>`;
  }
  html += "</table>";
  document.getElementById("lista").innerHTML = html;
}
function editarFuncionario(id,nome,cargo){
  document.getElementById('nome').value = nome;
  document.getElementById('cargo').value = cargo;
  excluirFuncionario(id);
}
async function excluirFuncionario(id){
  await fetch(`https://funcionarios-7c778-default-rtdb.firebaseio.com/funcionarios/${id}.json`,{method:"DELETE"});
  mostrarFuncionarios();
}

/* ---- LAN√áAMENTOS ---- */
async function salvarLancamento() {
  const data = dataLanc.value;
  const func = funcLanc.value.trim();
  const valor = valorLanc.value;
  if (!data || !func || !valor) return alert("Preencha todos os campos!");
  const dados = { data, func, valor };
  await fetch(URL_LANC, { method:"POST", body:JSON.stringify(dados) });
  alert("Lan√ßamento salvo!");
  dataLanc.value = ""; funcLanc.value = ""; valorLanc.value = "";
  dataLanc.focus();
}
async function mostrarLancamentos() {
  const resp = await fetch(URL_LANC);
  const data = await resp.json();
  let html = "<table><tr><th>Data</th><th>Funcion√°rio</th><th>Valor</th><th>A√ß√µes</th></tr>";
  for (let id in data) {
    html += `<tr>
      <td>${data[id].data}</td>
      <td>${data[id].func}</td>
      <td>R$ ${parseFloat(data[id].valor).toFixed(2)}</td>
      <td>
        <button onclick="editarLanc('${id}','${data[id].data}','${data[id].func}','${data[id].valor}')">‚úèÔ∏è</button>
        <button onclick="excluirLanc('${id}')">üóëÔ∏è</button>
      </td></tr>`;
  }
  html += "</table>";
  document.getElementById("listaLanc").innerHTML = html;
}
function editarLanc(id,data,func,valor){
  dataLanc.value = data;
  funcLanc.value = func;
  valorLanc.value = valor;
  excluirLanc(id);
}
async function excluirLanc(id){
  await fetch(`https://funcionarios-7c778-default-rtdb.firebaseio.com/lancamentos/${id}.json`,{method:"DELETE"});
  mostrarLancamentos();
}

/* ---- GERAR PDF ---- */
async function gerarPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  const resp = await fetch(URL_LANC);
  const data = await resp.json();
  if (!data) return alert("Nenhum lan√ßamento encontrado!");
  let y = 20;
  doc.text("Relat√≥rio de Lan√ßamentos", 70, 10);
  let totalGeral = 0;
  for (let id in data) {
    const l = data[id];
    doc.text(`${l.data} - ${l.func} - R$ ${parseFloat(l.valor).toFixed(2)}`, 10, y);
    y += 8;
    totalGeral += parseFloat(l.valor);
  }
  doc.text(`TOTAL GERAL: R$ ${totalGeral.toFixed(2)}`, 10, y + 10);
  doc.save("relatorio.pdf");
}

/* ---- MUDAR CAMPO COM ENTER ---- */
document.addEventListener("keydown", function(e) {
  if (e.key === "Enter") {
    const inputs = Array.from(document.querySelectorAll("input, select, textarea, button"));
    const atual = document.activeElement;
    const i = inputs.indexOf(atual);
    if (i > -1) {
      e.preventDefault();
      const proximo = inputs[i + 1];
      if (proximo) proximo.focus();
    }
  }
});

/* ---- FOCO INICIAL LOGIN ---- */
window.onload = () => document.getElementById("usuario").focus();
</script>
</body>
</html>
